<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Django Channels Chat</title>
</head>
<body>
<h1>Simple Chat Test</h1>

<!-- A box that will contain all messages -->
<div id="messages"></div>

<!-- Input field -->
<input id="messageInput" type="text" placeholder="Type a message">

<script>
    // 1. Open WebSocket connection to your Django backend
    const socket = new WebSocket("ws://127.0.0.1:8000/ws/chat/room2/");

    // 2. When WebSocket is successfully connected
    socket.onopen = function() {
        console.log("WebSocket connected");
    };

    // 3. Receive messages from the server
    socket.onmessage = function(event) {
        const data = JSON.parse(event.data);       // decode JSON
        const msgBox = document.getElementById("messages");

        const p = document.createElement("p");
        p.innerText = data.message;                // show message

        msgBox.appendChild(p);                     // add message to page
    };

    // 4. When user presses Enter in the input field â†’ send message
    document.getElementById("messageInput").addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
            const message = event.target.value;


            socket.send(JSON.stringify({           // send JSON
                "message": message
            }));

            event.target.value = "";              // clear input box
        }
    });
</script>
</body>
</html>
