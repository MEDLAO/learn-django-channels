<!DOCTYPE html>
<html>
<head>
    <title>Private Chat with {{ other_user.username }}</title>
</head>
<body>

<h1>Chat with {{ other_user.username }}</h1>

<div id="messages">
    {% for msg in messages %}
        <p>
            <strong>{{ msg.sender.username }}</strong>:
            {{ msg.content }}
        </p>
    {% endfor %}
</div>

<input id="messageInput" type="text" placeholder="Type a message and press Enter">

<script>
    // The username of the person we are talking to
    const receiverUsername = "{{ other_user.username }}";

    // Open the WebSocket connection to DMConsumer
    const socket = new WebSocket(
        "ws://" + window.location.host + "/ws/dm/" + receiverUsername + "/"
    );

    // Just to test that the WS is connected
    socket.onopen = function () {
        console.log("DM WebSocket connected!");
    };

    // When we receive a message from the server
    socket.onmessage = function (event) {
        const data = JSON.parse(event.data);

        const messagesDiv = document.getElementById("messages");
        const p = document.createElement("p");

        p.innerHTML = "<strong>" + data.sender + "</strong>: " + data.message;
        messagesDiv.appendChild(p);
    };

    document.getElementById("messageInput").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            socket.send(JSON.stringify({
                message: e.target.value
            }));
            e.target.value = "";
        }
    });
</script>


</body>
</html>
